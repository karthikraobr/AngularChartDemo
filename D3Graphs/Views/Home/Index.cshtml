<div ng-app="AngularCharts">
    <div ng-controller="MainCtrl">
        <button ng-click="getData()"> Fire!</button>
        <button ng-click="reset()"> Reset!</button>
        <canvas id="pie" tc-chartjs-pie class="chart chart-pie" chart-data="data" chart-labels="labels" chart-click="onClick" chart-options="chartOptions" chart-legend="true"></canvas>    
        <div id="js-legend" class="chart-legend"></div>
        <div ui-grid="gridOptions" ui-grid-grouping class="myGrid"></div>   
        </div>
      
    </div>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/angular.min.js"></script>
<script src="~/Scripts/ui-grid.min.js"></script>
<script src="~/Scripts/Chart.min.js"></script>
<script src="~/Scripts/angular-chart.min.js"></script>
<link href="~/Content/ui-grid.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Content/angular-chart.css" rel="stylesheet" />
<style>
    chart-legend li {
        list-style: none;
    }

        chart-legend li span {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
        }
</style>
<script>
    //Init
    var app = angular.module("AngularCharts", ["ui.grid", "ui.grid.grouping", "ui.grid.resizeColumns", "chart.js"]);
    app.controller('MainCtrl', function ($scope, $http) {
        //Method for pie chart selection
        $scope.onClick = function (selection) {
            if(selection)
                $scope.gridOptions.data = $scope.empData.filter(function (emp) { return emp.Department == selection[0].label.replace(/\D/g, '') })
        };
        //Method for resetting grid to default state
        $scope.reset = function () { $scope.gridOptions.data = $scope.empData }

        //The grid options
        $scope.gridOptions = {
            enableGridMenu: true,
            showGridFooter: true,
            enableFiltering: true,
            enableColumnResizing: true,
            columnDefs:
                [
              { name: 'Id' },
              { name: 'Name' },
              { name: 'Department'},
              { name: 'Date Of Birth', field: 'DOB', type: 'date', cellFilter: 'date:\'yyyy-MM-dd\'' },
              { name: 'Address' },
              { name: 'Category'  },
              { name: 'Salary' }
                ]
        }
        $scope.chartOptions = {
            //Boolean - Whether we should show a stroke on each segment
            segmentShowStroke: true,

            //String - The colour of each segment stroke
            segmentStrokeColor: "#fff",

            //Number - The width of each segment stroke
            segmentStrokeWidth: 2,

            //Number - Amount of animation steps
            animationSteps: 100,

            //String - Animation easing effect
            animationEasing: "easeOutBounce",

            //Boolean - Whether we animate the rotation of the Doughnut
            animateRotate: true,

            //Boolean - Whether we animate scaling the Doughnut from the centre
            animateScale: false

        }
        $scope.getData = function () {

            $http.get("/Home/GetEmployees/" + 30000)
                         .success(function (response) {
                             //Global object for resetting grid to default state
                             $scope.empData = response.Employees;
                             //Actual data bound to grid
                             $scope.gridOptions.data = response.Employees;
                             $scope.labels = response.Departments.map(function (dept) { return "Department "+ dept});
                             
                             $scope.data = [];
                             response.Departments.forEach(function (dept) {
                                 $scope.data.push( $scope.empData.filter(function (emp) { return emp.Department == dept }).length)
                             });
                         })
                         .error(function (response) {
                             $scope.error = response.data;
                             $scope.status = "Page load failed.";
                         });


        }
    });
</script>